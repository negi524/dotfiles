#!/bin/bash
set -eu

DOTPATH="${HOME}/dotfiles"

. ${DOTPATH}/etc/logger.sh
. ${DOTPATH}/etc/neovim_setting.sh

cd ${DOTPATH}

# main関数
# 全ての設定ファイルに対してシンボリックリンクを作成する
function main () {

  local DOTLIST=(".vimrc" ".bash_profile" ".zprofile" ".zshrc")
  DOTLIST+=(".bashrc")
  DOTLIST+=(".tmux.conf")
  DOTLIST+=(".Brewfile")

  for var in ${DOTLIST[@]}
  do
    create_ln ${var}
  done

  # Neovim -----------------------------------
  neovim_setting

  # Claude Skills ----------------------------
  claude_skills_setting
}

# シンボリックリンクを貼る関数
# 同じファイルが存在する場合、上書きする
# $1: 対象ファイル
function create_ln () {
  local FILE=$1

  ln -vsf ${DOTPATH}/${FILE} ${HOME}/${FILE}
  return 0
}

# 対象のディレクトリがない場合は作成する関数
# $1: 対象ディレクトリ
function set_dir () {
  local DIR=$1

  if [ ! -d ${HOME}/${DIR} ]; then
    mkdir -p ${HOME}/${DIR}
  fi
  return 0
}

# Claude Skillsのシンボリックリンクを設定する関数
function claude_skills_setting () {
  local SKILLS_SOURCE_DIR="${DOTPATH}/.claude/skills"

  # .claude/skillsディレクトリが存在しない場合は作成
  set_dir ".claude/skills"

  # dotfiles内のskillsディレクトリに対してシンボリックリンクを作成
  if [ -d "${SKILLS_SOURCE_DIR}" ]; then
    for skill_dir in ${SKILLS_SOURCE_DIR}/*/; do
      if [ -d "$skill_dir" ]; then
        local skill_name=$(basename "$skill_dir")
        ln -vsf ${SKILLS_SOURCE_DIR}/${skill_name} ${HOME}/.claude/skills/${skill_name}
      fi
    done
  fi
}

# main関数実行
main


exit 0
