---
name: pr-learning
description: PRの内容からコーディング規則や実装パターンを学習し、ガイドラインスキルに蓄積する。「このPRから学習して」「PRの知見を蓄積して」「PRをレビューして学習」の際に使用。
---

# PR Learning Skill

PRの内容（差分、コメント、レビュー）から知識を抽出し、ガイドラインスキルに蓄積するスキルです。

## 使用方法

```
/pr-learning https://github.com/org/repo/pull/123
```

または、現在のブランチに関連するPRから学習：
```
/pr-learning
```

---

## 実行手順

### 1. PR情報の取得
```bash
# 自分のGitHubユーザー名を取得
gh api user --jq '.login'

# PRの詳細を取得
gh pr view <PR番号> --json title,body,additions,deletions,changedFiles

# 差分を取得
gh pr diff <PR番号>

# コメントとレビューを取得
gh pr view <PR番号> --comments
gh api repos/{owner}/{repo}/pulls/{pr}/comments
gh api repos/{owner}/{repo}/pulls/{pr}/reviews
```

### 2. 学習観点での分析

**重要: 自分自身の指摘コメントを中心に知識を抽出する**

PRのコメントを分析する際は、以下を意識する：

- **自分の指摘コメントを優先**: 改善提案、問題点の指摘、ベストプラクティスへの誘導など
- **メモ的なコメントは除外**: 単なるメモや確認コメントは学習対象外
- **指摘コメントの特徴**: 「〜すべき」「〜した方がいい」「〜は避ける」「なぜ〜？」など

以下の観点でPRを分析し、知識を抽出する：

#### コーディングパターン
- 採用されている実装パターン
- エラーハンドリングの方法
- 命名規則・コードスタイル

#### 設計判断
- アーキテクチャ上の決定とその理由
- トレードオフの考慮
- 将来の拡張性への配慮

#### ベストプラクティス
- レビューで指摘・改善された点
- 採用されたライブラリとその選定理由
- アンチパターンの回避例

### 3. 該当ガイドラインスキルの特定

抽出した知識を以下のスキルに分類：

| 知識の種類 | 保存先スキル |
|-----------|-------------|
| 日時処理関連 | `guideline-datetime` |
| ライブラリ選定・活用 | `guideline-library-usage` |
| その他（新規カテゴリ） | 新規スキル作成を提案 |

### 4. ガイドラインスキルへの追記

該当する`guideline-*/SKILL.md`の「学習した知識」セクションに追記：

```markdown
### [学習内容のタイトル]
**学習元**: PR#123 (2024-12-19) - [PRタイトル]
**リポジトリ**: owner/repo

**内容**:
[具体的な学習内容]

**コード例**:
```[言語]
[具体的なコード]
```

**理由・背景**:
[なぜこのパターンが良いのか]
```

### 5. 追加内容の確認

追記内容をユーザーに提示し、確認を求める。必要に応じて修正。

---

## 出力形式

### 学習レポート
```markdown
# PR学習レポート

## PR情報
- **URL**: https://github.com/org/repo/pull/123
- **タイトル**: [PRタイトル]
- **変更規模**: +XXX/-YYY (ZZ files)

## 抽出した知識

### 1. [知識タイトル1]
- **カテゴリ**: guideline-datetime
- **概要**: [要約]
- **追記内容**: [ガイドラインに追加する内容]

### 2. [知識タイトル2]
- **カテゴリ**: guideline-library-usage
- **概要**: [要約]
- **追記内容**: [ガイドラインに追加する内容]

## アクション
上記の内容を該当するガイドラインスキルに追記しますか？
```

---

## 新規ガイドラインスキルの作成

既存のガイドラインに該当しない知識を発見した場合：

1. ユーザーに新規スキル作成を提案
2. 承認されたら以下の形式で作成：

```markdown
---
name: guideline-[カテゴリ名]
description: [説明。実装時に自動参照されるようキーワードを含める]
---

# [カテゴリ名]ガイドライン

## 基本原則
[PRから抽出した原則]

## アンチパターン
[避けるべきパターン]

## 推奨パターン
[推奨されるパターン]

---

## 学習した知識

### [最初の学習内容]
**学習元**: PR#xxx (yyyy-mm-dd)
...
```

---

## 学習サイクル

```
[良いPRを発見]
    ↓
[/pr-learning を実行]
    ↓
[知識を抽出・分類]
    ↓
[guideline-*/SKILL.md に追記]
    ↓
[次回実装時にClaude Codeが自動参照]
    ↓
[コード品質向上]
```

---

## 関連スキル

- `guideline-datetime`: 日時処理ガイドライン
- `guideline-library-usage`: ライブラリ活用ガイドライン
- `code-review-bugs`: バグ検出レビュー
- `code-review-maintainability`: 保守性レビュー
- `code-review-simplify`: シンプル化レビュー
